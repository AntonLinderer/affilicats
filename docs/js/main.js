/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(()=>{var a=Math.floor;const b="Felis silvestris catus",c=2,d=document.querySelector(".offline"),e=document.querySelector("main"),f=document.querySelector("input[type=\"search\"]"),g=document.querySelector("button[type=\"submit\"]"),h=document.getElementById("cat"),i=document.querySelector(".install");let j,k;const l=new IntersectionObserver(a=>{a.forEach(a=>{if(0<a.intersectionRatio){const b=a.target;if(l.unobserve(b),"IMG"===b.nodeName)return b.src=`${b.dataset.src}${/\?/.test(b.dataset.src)?"&":"?"}${Math.random().toString().substr(2)}`;const c=b.classList;if(c.contains("photos"))return q(b);if(c.contains("reviews"))return p(b);if(c.contains("offers"))return o(b)}})}),m=async a=>{const b=`https://commons.wikimedia.org/w/api.php
        ?action=query
        &generator=categorymembers
        &gcmlimit=max
        &gcmtype=file
        &gcmtitle=Category:${encodeURIComponent(a.replace(/\s/g," "))}
        &prop=imageinfo
        &iiurlwidth=500
        &iiprop=extmetadata|url
        &iiextmetadatafilter=ImageDescription
        &format=json&origin=*`.replace(/\n\s*/g,"");return fetch(b).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${b}`);return a.json()}).then(a=>a&&a.query&&a.query.pages?Object.keys(a.query.pages).map(b=>{let c=a.query.pages[b];try{c=c.imageinfo[0];const a=c.thumburl,b=c.descriptionshorturl,d=c.thumbwidth,e=c.thumbheight,f=c.extmetadata.ImageDescription.value;return{url:b,src:a,description:f,width:d,height:e}}catch(a){}}).filter(a=>"undefined"!=typeof a):void 0).catch(a=>console.error(a))},n=(b,d,e)=>{const g=k&&"pushManager"in k,h=document.createDocumentFragment();b.forEach((b,e)=>{var i=Math.round;const j=document.importNode(d.content,!0),k=j.querySelector("figure img");k.alt=`Illustrative ${f.value.toLowerCase()} image`,k.classList.add("lazyload"),k.dataset.src=b.src;const l=j.querySelector("figcaption");l.textContent=(l.innerHTML=b.description,l.textContent);const m=j.querySelector(".pricedrop");g?(m.addEventListener("click",()=>{m.innerHTML=m.innerHTML.replace("\uD83D\uDECE","\u23F3"),(async()=>{const a=await u();a?(m.disabled=!0,m.dataset.active="false",m.innerHTML=m.innerHTML.replace("\u23F3","\u2705")):m.innerHTML=m.innerHTML.replace("\u23F3","\uD83D\uDECE")})()}),m.hidden=!1):m.hidden=!0;const n=j.querySelector(".cuteness");n.textContent=`${"\uD83D\uDE3B".repeat(a(5*Math.random())+1)}`;const o=j.querySelector(".price");o.textContent=`${"\uD83D\uDCB0".repeat(a(3*Math.random())+1)}`;const p=j.querySelector(".outlink"),q=`./forward.html?url=${encodeURIComponent(b.url)}`;p.dataset.href=q,j.querySelector(".offers").dataset.outclickURL=q,p.textContent="\uD83D\uDCE6 View Deal",p.addEventListener("click",()=>{let a=localStorage.getItem("engagement");a?(a=parseInt(a,10),!isNaN(a)&&a<c&&localStorage.setItem("engagement",++a)):localStorage.setItem("engagement",1),document.location.href=p.dataset.href});const s=j.querySelector(".tabs");s.addEventListener("click",()=>{r(s)});const t=s.querySelectorAll(".tab label"),v=s.querySelectorAll(".tabcontent");s.querySelectorAll(".tab input").forEach((a,b)=>{const c=Math.random().toString().substr(2);a.name=`tabgroup${e}`,a.id=c,t[b].setAttribute("for",c),v[b].setAttribute("aria-labelledby",c)});const w=s.querySelector(".map"),x=i(1e5*(90*((.5>Math.random()?-1:1)*Math.random())))/1e5,y=i(1e5*(180*((.5>Math.random()?-1:1)*Math.random())))/1e5;w.dataset.src=`https://maps.googleapis.com/maps/api/staticmap
          ?autoscale=1
          &size=500x350
          &maptype=terrain
          &key=AIzaSyBWZnCRi6oar3MTjR0HkR1lK52_mTe0Rks
          &format=png
          &markers=size:small%7Ccolor:0xfffb00%7C${x},${y}`.replace(/\n\s*/g,""),w.alt=`Map centered on latitude ${x} and longitude ${y}`,s.querySelector(".lat").textContent=x,s.querySelector(".long").textContent=y,h.appendChild(j)}),e.innerHTML="",e.appendChild(h)},o=b=>{const c=b.dataset.outclickURL,d=document.createDocumentFragment(),e=`https://www.random.org/integers/
        ?num=${a(4*Math.random())+2}
        &min=5&max=20&col=1&base=10&format=plain&rnd=new`.replace(/\n\s*/g,"");fetch(e).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${e}`);return a.text()}).then(a=>{let e=a.split(/\n/g);e.splice(-1,1),e.map(a=>isNaN(parseInt(a,10))?a:parseInt(a+"9",10)).sort((c,a)=>c-a).map((a,b)=>{const e=document.createElement("li");e.innerHTML=/\d+/.test(a)?`<sup>$</sup>
                    <span class="price">${a}</span> |
                    <a href="${c}">Affiliate ${b}</a>`:a,d.appendChild(e)}),b.innerHTML="",b.appendChild(d)}).catch(a=>console.error(a))},p=b=>{const c=document.createDocumentFragment(),d=[];for(let c=0,e=a(6*Math.random())+2;c<e;c++){const b=`https://baconipsum.com/api/?type=all-meat&paras=${a(3*Math.random())+1}&start-with-lorem=1&random=${c}`;d[c]=fetch(b).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${b}`);return a.json()}).then(a=>`<li>${a.map(a=>`<p>${a}</p>`).join("")}</li>`).catch(a=>console.error(a))}Promise.all(d).then(a=>a.join("")).then(a=>{const d=document.createElement("ul");d.innerHTML=a,c.appendChild(d),b.innerHTML="",b.appendChild(c)})},q=b=>{const c=document.createDocumentFragment(),d=document.createElement("div");d.classList.add("gallery"),c.appendChild(d);const e=[];for(let c=0,d=a(15*Math.random())+2;c<d;c++){const b=10*(a(10*Math.random())+20),d=10*(a(5*Math.random())+20),f=`https://placekitten.com/${b}/${d}?random=${c}`;e[c]=fetch(f).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${f}`);return a.blob()}).then(a=>({width:b,height:d,blob:a}))}Promise.all(e).then(a=>{a.forEach(a=>{const b=new Image(a.width,a.height);b.alt=`Illustrative ${f.value.toLowerCase()} image`,b.src=URL.createObjectURL(a.blob),d.appendChild(b)}),b.innerHTML="",b.appendChild(c)}).catch(a=>console.error(a))},r=(a=!1)=>{const b=a?a.querySelectorAll(".lazyload"):document.querySelectorAll(".lazyload");b.forEach(a=>{l.observe(a)})};window.addEventListener("offline",()=>{d.style.display="flex",f.disabled=!0,g.disabled=!0,document.querySelectorAll("[data-active=\"true\"]").forEach(a=>{a.disabled=!0})}),window.addEventListener("online",()=>{d.style.display="none",f.disabled=!1,g.disabled=!1,document.querySelectorAll("[data-active=\"true\"]").forEach(a=>{a.disabled=!1}),"false"===e.dataset.hydrated&&w(),r()});const s=()=>{e.innerHTML="";for(let a=0;3>a;a++){const b=h.content,c=b.querySelectorAll(".tab label"),d=b.querySelectorAll(".tabcontent");b.querySelectorAll(".tab input").forEach((b,e)=>{const f=Math.random().toString().substr(2);b.name=`tabgroup${a}`,b.id=f,c[e].setAttribute("for",f),d[e].setAttribute("aria-labelledby",f)}),e.appendChild(document.importNode(b,!0))}},t=()=>{document.querySelector("form").addEventListener("submit",a=>{a.preventDefault(),s(),w()}),window.addEventListener("beforeinstallprompt",a=>{let b=localStorage.getItem("engagement");return b?(b=parseInt(b,10),isNaN(b)||b<c?void console.log("Install button hidden due to not enough prior engagement"):void(a.preventDefault(),j=a,i.disabled=!1,i.hidden=!1)):void console.log("Install button hidden due to no prior engagement")}),i.addEventListener("click",()=>{i.disabled=!0,i.hidden=!0,j.prompt(),j.userChoice.then(a=>{"accepted"===a.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),j=null})}),s();const a=navigator.onLine;d.style.display=a?"none":"flex",f.disabled=!a,g.disabled=!a,a&&w(),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(a=>{k=a,k.onupdatefound=v,v()}).catch(a=>console.error(a))},u=async()=>{if(!k||!("pushManager"in k))return!1;const a=a=>{const b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,"+").replace(/_/g,"/"),d=window.atob(c),e=new Uint8Array(d.length);for(let b=0;b<d.length;++b)e[b]=d.charCodeAt(b);return e};return k.pushManager.getSubscription().then(b=>{if(b)return b;const c=a("BHuCD9Ym4yXI9Fk0KHrRcPgH2iQOXhoWbzWtm4GQocD1zGYz4IXyazINE_-T4pEojrAgqoGoRnxUgX5CAuguRGo");return k.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:c})}).then(a=>(fetch("https://affilicats-push.glitch.me/push/sendNotification",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({subscription:a,delay:5,ttl:0})}),fetch("https://affilicats-push.glitch.me/push/register",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({subscription:a})}).then(a=>a.ok))).catch(a=>(console.error(a),!1))},v=async()=>{const a=async a=>{const b=new Request(a,{mode:"no-cors"});return fetch(b).then(a=>c.put(b,a)).catch(a=>console.error(a))},b=await caches.keys(),c=await caches.open(b.filter(a=>/^offline_/.test(a))[0]);for(let b=0;b<localStorage.length;b++){const c=localStorage.key(b);"polyfill"===localStorage.getItem(c)&&("IntersectionObserver"===c?a("https://unpkg.com/intersection-observer@0.5.0/intersection-observer.js"):"PWACompat"===c?a("https://unpkg.com/pwacompat@2.0.7/pwacompat.min.js"):"URLSearchParams"===c?a("https://unpkg.com/url-search-params@1.1.0/build/url-search-params.js"):void 0)}},w=async()=>{const a=new URLSearchParams(document.location.search),c=a.get("query");c&&!f.value&&(f.value=c),c||f.value||(f.value=b);const d=f.value||b,g=await m(d);Array.isArray(g)&&0<g.length?(e.dataset.hydrated="true",d!==b&&history.pushState({},"",`${document.location.origin}${document.location.pathname}?query=${encodeURIComponent(d)}`),n(g,h,e)):e.innerHTML=`<p>😥 No results found.</p>
          <p>Try anything that is a
          <a href="https://commons.wikimedia.org/wiki/Category:Topics">
          Wikimedia Categorie</a>. Maybe try
          <a href="./?query=Elephants">Elephants</a> 🐘</p>`,r()};t()})();